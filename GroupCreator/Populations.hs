module GroupCreator.Populations
( Population(..)
, randomPopulation
, newPopulation
, selectTwo
, bestIn
) where

--import qualified Data.Map as M
import Data.Map
import GroupCreator.Groupings
import GroupCreator.Evaluation
import GroupCreator.People

--data Population = Population [Grouping]
--  deriving (Eq, Show)
type Population = Map Double Grouping

randomPopulation :: [Condition] -> People -> Population
randomPopulation conditions people = fromList $ Prelude.map convert groupings
  where
    convert :: Grouping -> (Double, Grouping)
    convert a = (fitness 0 conditions people a, a)
    groupings =
      [ Grouping [[19,23,2],[12,25,11,27],[13,0,20,28],[14,21,1,9],[4,29,26,7],[16,24,22,3],[10,6,15,5],[18,17,8]]
      , Grouping [[26,0,14,1],[7,22,19],[11,29,13,25],[21,8,18,10],[4,20,5,12,6],[9,24,3],[23,15,17],[27,2,16,28]]
      , Grouping [[23,16,21,25,8],[12,22,18,7],[29,19,11],[20,10,14,9],[3,26,1,5],[17,27,13],[15,2,28,24],[6,4,0]]
      , Grouping [[6,5,10],[4,17,28,9],[0,25,2],[8,3,26,22,21],[18,13,7,1],[14,23,27,24],[12,19,15,16,20],[11,29]]
      , Grouping [[10,23,22,28],[7,15,4],[21,5,1],[19,27,25],[6,2,20],[18,29,9],[17,12,11,3],[13,26,14,8],[16,0,24]]
      , Grouping [[15,29,17,8],[1,16,22],[12,6,10],[5,3,14,2],[26,23,24],[7,20,19,21],[18,11,13,25],[4,27,0,9],[28]]
      , Grouping [[6,14,23],[24,18,9,16,28],[7,25,29,21,27],[15,13,1],[11,8,0,26],[22,10,12],[17,3,4,19],[2,5,20]]
      , Grouping [[20,19,28,10],[23,12,24,13],[17,18,2,0,4],[1,29,14,6],[15,25,22],[27,11,26,21],[16,5,3],[7,8,9]]
      , Grouping [[9,20,22,11,26],[4,23,25,21],[28,14,29,3],[27,13,1],[24,0,10,12],[7,2,5,18],[6,19,16,8],[15,17]]
      , Grouping [[28,14,2],[3,10,25],[16,24,12,6,22],[26,17,11,0],[5,9,1,15],[23,29,7,13],[27,20,21,4,8],[18,19]]
      , Grouping [[22,11,29,12],[23,20,4,7],[27,3,6,8,18],[1,19,25,9],[5,0,13],[2,10,21,17,26],[14,24,16,28],[15]]
      , Grouping [[19,14,15],[5,25,20],[11,24,0,16],[28,2,4],[3,13,21,23,10],[1,17,18,7],[8,29,12,22,6],[27,9,26]]
      , Grouping [[7,11,15],[26,1,27,17],[5,8,19],[29,4,28,18,0],[3,24,6],[20,22,10],[2,9,25,13,23],[21,16,12,14]]
      , Grouping [[5,11,1,15],[22,4,17,29,28],[3,24,7,0],[21,19,12,20,9],[8,2,18,10,16],[26,13,14,23],[25,27,6]]
      , Grouping [[0,9,6],[13,11,8,2,26],[28,17,25,18],[22,24,21,5],[4,14,23,3],[15,7,19,20,16],[1,27,12,10],[29]]
      , Grouping [[9,6,4,1],[5,17,18,15,27],[13,29,10],[3,2,7,8],[16,20,21,22],[25,0,26,24,12],[19,11,28,23],[14]]
      , Grouping [[7,23,12],[6,11,26],[25,2,3,5],[21,24,13,0],[17,27,4,8],[22,14,20,18],[10,16,15,29],[9,28,1,19]]
      , Grouping [[5,20,29,26],[13,11,10],[28,21,4],[23,15,25,6,18],[24,3,22,0],[9,1,12,19],[16,17,27,14],[7,8,2]]
      , Grouping [[26,0,11,7],[6,23,1],[28,13,14],[8,9,22,3,17],[24,4,15],[5,25,29,12],[20,27,21,16],[18,19,10,2]]
      , Grouping [[7,16,25,1],[14,24,8],[11,0,2],[29,26,15,6,18],[21,3,5,13],[4,22,27,10,28],[19,12,20],[17,23,9]]
      , Grouping [[25,5,20,17],[11,28,23],[12,16,10,0,18],[7,15,9,14],[4,24,22],[26,8,13,27],[3,19,21],[1,29,2,6]]
      , Grouping [[19,25,13,1],[18,14,9,29],[4,2,24,20,8],[23,3,7,17,27],[21,28,11,15,6],[10,5,12,16,22],[0,26]]
      , Grouping [[5,29,3],[22,16,1,4,8],[20,6,14,25,21],[12,7,24],[15,19,27],[26,11,23,17],[18,0,10],[9,28,2,13]]
      , Grouping [[22,2,28],[16,6,24,5],[25,29,3,10],[20,0,7,9,15],[26,27,19,13],[11,8,17,18],[12,21,23,4,1],[14]]
      , Grouping [[7,0,3,20],[5,24,26,16],[17,10,9,11],[19,25,12,23],[27,1,13,14],[6,22,4,2],[8,15,18,29],[21,28]]
      , Grouping [[2,29,7,16],[8,23,11],[18,4,17],[9,22,3,12,28],[14,5,27,19],[25,0,10,24],[26,1,13,15],[21,20,6]]
      , Grouping [[2,23,12,9],[21,15,3],[16,22,29],[17,1,0,4,26],[28,20,5],[8,6,25,11,13],[10,14,19,27,7],[18,24]]
      , Grouping [[1,12,17,7,9],[21,27,23],[20,8,18,19],[28,4,26],[13,0,22,29],[11,5,16,3],[15,25,6,10,2],[24,14]]
      , Grouping [[4,11,25],[14,10,7],[0,1,20,18],[8,17,9,21],[12,29,19,13,3],[28,15,5,16],[22,23,27,6],[24,26,2]]
      , Grouping [[15,20,27,23],[11,4,6],[26,29,12],[0,25,16,2],[28,13,7,22,5],[1,10,3,9],[19,21,24,14],[8,18,17]]
      , Grouping [[16,6,28],[15,9,27,17],[29,24,20],[18,10,12,2],[21,5,19,7],[25,8,13],[3,26,0,1],[11,23,14,4,22]]
      , Grouping [[2,20,14,25],[13,3,6,22],[15,0,11,9,12],[28,1,17,5,19],[4,8,24],[18,10,27,16,29],[7,26,23,21]]
      , Grouping [[23,13,16],[10,3,27],[15,8,24,26],[2,18,28],[14,11,0],[7,17,12,19],[1,29,22],[4,25,9,21],[20,5,6]]
      , Grouping [[26,22,10],[23,9,15],[14,1,19,7],[20,8,2,29],[16,28,5,18,3],[21,13,25],[27,12,6],[24,11,17,4],[0]]
      , Grouping [[6,8,0,9],[2,4,16,3],[11,28,12,24],[20,23,27,29],[26,5,18],[17,21,7],[25,13,19,10,1],[14,15,22]]
      , Grouping [[14,1,4,11,5],[12,6,28],[18,22,24,16,25],[17,3,15,10,0],[29,19,9,26],[23,20,7,27],[8,13,2],[21]]
      , Grouping [[17,5,10,2],[16,24,8],[27,0,7,4,19],[13,9,28],[29,20,25,21],[1,15,14,6],[22,26,11,18],[23,3,12]]
      , Grouping [[13,10,3,11,0],[12,16,14,25,29],[4,1,15,19],[28,18,23],[22,2,21,24,6],[26,8,17,5],[27,20,9,7]]
      , Grouping [[17,6,15,19],[25,29,28,18],[20,27,3,1],[23,26,7,16],[2,22,14,0],[21,11,8,5,10],[4,24,13],[9,12]]
      , Grouping [[29,11,13],[19,16,17,10,9],[8,25,18],[5,4,22,12],[27,7,2],[20,0,21],[14,23,24],[1,28,15],[26,6,3]]
      , Grouping [[3,0,19,17],[5,13,16,29],[21,1,25,8],[28,4,12,11],[22,24,6,27,20],[7,9,18],[10,23,15,26],[14,2]]
      , Grouping [[19,12,1,2,22],[0,15,17],[27,10,4,23],[18,8,3],[14,11,28,16],[29,5,25,7,20],[9,6,26,21,24],[13]]
      , Grouping [[24,6,17],[7,12,26],[8,21,2,13],[23,4,0,25,5],[9,28,20,16],[1,22,14],[29,10,15,11,19],[3,27,18]]
      , Grouping [[17,21,15],[18,5,2],[12,23,27,22,3],[28,26,0,4,8],[1,16,29,25,9],[10,7,20,24,14],[13,11,19,6]]
      , Grouping [[14,22,4,10],[18,7,19,5,25],[29,23,1],[15,24,26],[12,20,11,6,3],[0,21,8,28],[2,27,9],[16,17,13]]
      , Grouping [[9,6,21,16],[17,23,22],[20,18,19],[7,4,12,1],[3,27,28],[25,0,8,11,5],[13,26,2],[14,10,29,24,15]]
      , Grouping [[26,18,12,3,7],[15,10,4],[1,13,28,11],[29,2,5,21],[24,6,8,14],[20,25,19,17],[9,23,16,22],[0,27]]
      , Grouping [[6,23,3,25],[12,27,0,24],[20,8,18,1,21],[4,22,2,29],[5,10,11,15],[19,16,9,26,28],[14,17,7,13]]
      , Grouping [[14,21,20,5,8],[10,26,1,12,29],[0,18,4,3,27],[28,24,15,2],[25,19,7,13,22],[17,11,6,16],[23,9]]
      , Grouping [[2,14,27,0],[3,10,25,17,20],[16,11,21],[6,8,12,23,15],[28,1,5,18],[24,29,26,4],[9,22,7,13],[19]]
      , Grouping [[0,13,29,6],[10,3,22,4],[21,9,1,24],[28,23,12],[2,7,20],[26,11,19],[17,25,18,15],[27,14,5],[8,16]]
      , Grouping [[20,28,6],[3,0,19,16,22],[9,21,23,15],[18,10,14,17,29],[11,27,1,5],[7,26,12],[2,24,25,8],[13,4]]
      , Grouping [[20,10,22,4],[9,19,29,24],[5,8,13,14,2],[15,17,11,0,21],[25,1,7,27,16],[18,23,3],[12,26,28,6]]
      , Grouping [[20,8,25],[9,3,21],[15,24,2,19],[22,14,23],[28,13,12,26,17],[27,0,4],[7,16,6,10,11],[1,18,29],[5]]
      , Grouping [[3,26,24],[12,27,16,11],[19,10,28],[22,20,15],[21,29,4],[0,14,7],[6,2,13],[1,23,5,18],[17,25,9,8]]
      , Grouping [[19,10,17,0],[24,23,25],[1,2,9],[12,26,15],[13,29,22,8],[27,21,4,7],[18,5,6,16,20],[11,14,3],[28]]
      , Grouping [[8,20,22,27,5],[9,25,19,10,17],[23,4,15,16],[7,12,0,18],[14,6,2],[3,24,21,13],[29,26,28,11],[1]]
      , Grouping [[0,21,27,26,4],[5,11,7,10],[29,23,18],[13,14,28,12],[1,22,19,17],[20,24,15,3],[8,6,9,2,16],[25]]
      , Grouping [[7,27,13,28,14],[4,17,15,25],[6,2,10,26],[19,11,5,29],[9,1,23,12],[21,16,18],[22,8,0],[20,24,3]]
      , Grouping [[4,1,2],[24,8,20],[10,21,19,17,25],[6,12,26,13],[15,27,18,16],[28,3,29],[23,11,5,22],[0,7,9,14]]
      , Grouping [[7,10,29],[4,1,16,8,22],[18,23,24,11],[19,21,14],[15,25,0],[12,17,28,20],[3,6,2],[26,9,5],[13,27]]
      , Grouping [[28,13,14,27],[5,17,2],[6,8,16,10,15],[26,3,18,24,22],[25,1,19,12],[0,9,4,23,21],[20,11,7,29]]
      , Grouping [[10,22,17,4],[9,15,28,20],[6,0,12,3],[27,5,1,11],[18,25,13,24],[19,14,16],[29,23,21,7],[8,26,2]]
      , Grouping [[16,3,25],[29,6,9,19],[27,0,13],[7,15,24],[14,12,4],[8,18,26,20],[2,23,10],[1,17,11,22],[28,5,21]]
      , Grouping [[11,17,6],[7,19,8,27],[4,10,29],[28,18,0],[3,14,1,15,26],[22,12,2],[9,25,24,20,16],[23,21,5,13]]
      , Grouping [[10,29,6,7],[28,4,16,14],[17,9,15],[23,13,24,12],[5,19,27],[11,22,20],[21,2,26,8,3],[0,25,1,18]]
      , Grouping [[16,4,13],[22,1,9,15],[27,10,25],[0,18,20,7],[26,28,8],[14,3,21,5],[23,19,29,6],[17,12,11,2],[24]]
      , Grouping [[23,6,29,9,19],[28,17,27],[12,15,5,0,4],[1,25,13,11],[20,14,22,18],[16,24,10,7],[3,2,8,21,26]]
      , Grouping [[0,13,3,10],[18,22,25,16],[20,15,12,17],[29,2,11,8],[28,21,14,26],[4,7,24],[5,19,9,1],[27,6,23]]
      , Grouping [[24,4,28,8],[25,3,17],[26,23,7,19],[11,0,18,13,16],[22,21,15,6],[20,12,10,9],[1,29,5],[27,14,2]]
      , Grouping [[22,25,19,7],[27,17,21,28],[3,23,8,13],[1,16,15,20],[9,6,4],[5,11,14],[0,12,24],[10,2,26],[18,29]]
      , Grouping [[21,13,19,28],[29,15,22],[8,0,17,18,10],[20,5,16],[14,2,12,11],[6,9,26,23],[7,4,1],[27,25,3,24]]
      , Grouping [[15,11,8],[1,5,25,2],[28,13,21,23],[18,24,26],[7,0,14,20],[22,6,9,27],[12,17,19,16,4],[3,10,29]]
      , Grouping [[18,4,14,24],[21,10,22],[26,2,8,3,20],[1,28,9],[15,13,19,6,0],[29,5,16,23],[27,11,12],[17,25,7]]
      , Grouping [[29,6,0,7,9],[18,12,24,1,28],[26,23,22,8],[3,16,17,20,5],[2,15,4,11,27],[19,21,25,10,14],[13]]
      , Grouping [[9,12,1,22],[7,6,0,19],[8,10,4,23],[5,29,14,25],[18,28,20],[13,27,2,16],[11,24,26,17],[3,21,15]]
      , Grouping [[21,14,13,25],[2,12,10,9],[24,29,1],[5,23,6,22],[28,27,18,7],[15,20,4,3],[17,0,16],[19,26,8,11]]
      , Grouping [[1,2,15,9],[3,20,6,23,0],[11,4,13],[7,27,5],[26,10,16,19,8],[24,22,29,25,12],[17,21,14,28],[18]]
      , Grouping [[4,3,9,15,20],[22,14,18,8,5],[7,0,25,2],[24,23,21],[1,17,26,29],[28,6,19,12],[10,13,11,27,16]]
      , Grouping [[9,29,1,26,28],[17,15,10,6],[11,21,12,14],[0,19,24],[5,3,23,27],[25,13,7,20,22],[2,18,4,16],[8]]
      , Grouping [[26,4,24,19,3],[16,29,28],[7,25,12,21],[10,2,15,0,17],[8,27,5],[20,6,9,13,22],[1,11,18,23,14]]
      , Grouping [[26,29,3],[2,1,25,0],[24,8,4,10],[19,5,9,28,7],[21,13,11,15,6],[12,22,20,14,17],[23,16,18,27]]
      , Grouping [[28,12,0,20,22],[6,15,17,1],[7,3,21,2],[9,8,11,18,29],[14,27,24],[25,26,16,4,5],[23,19,13,10]]
      , Grouping [[5,28,13,14],[3,27,24,23],[6,10,25,19],[8,15,1,2,21],[22,7,0,4],[29,18,12,20],[9,11,17,26,16]]
      , Grouping [[0,12,16,26],[8,19,28],[27,3,13,25,14],[17,5,6,4],[23,1,24],[20,15,7,29,11],[9,10,18],[22,21,2]]
      , Grouping [[18,8,16,28,22],[14,3,10,1,7],[0,5,27],[12,6,21,2],[23,13,19],[17,9,26],[11,15,4,20],[24,29,25]]
      , Grouping [[16,9,28,1],[10,4,26,11],[25,5,14,20,21],[17,27,22,18,8],[0,3,12,6,2],[13,23,15,19],[7,29,24]]
      , Grouping [[25,8,19,22],[23,1,0],[4,28,21,18],[29,17,10],[26,27,15,9,3],[16,24,2,7,12],[6,20,5,11],[13,14]]
      , Grouping [[22,24,25,3],[2,7,6,5],[4,20,27,16,21],[17,1,28],[0,13,18,23],[14,15,29],[8,19,9,26],[10,11,12]]
      , Grouping [[23,3,9,0],[6,5,12,18],[21,4,20,29,19],[7,22,10],[1,11,13,16],[14,25,8,15],[24,27,17,26,28],[2]]
      , Grouping [[26,10,6],[16,23,7,29,20],[3,0,27,25,19],[28,13,2],[4,12,9],[1,5,22,21],[8,24,11,14],[18,17,15]]
      , Grouping [[6,22,17,29,12],[21,28,19,1,4],[9,3,15,2],[16,5,14],[7,25,10],[13,18,26],[20,0,11,8],[23,27,24]]
      , Grouping [[6,9,7,11],[13,22,24,16,21],[23,19,15,29],[25,12,28],[3,1,17,20],[4,0,26,10],[2,8,27,14],[18,5]]
      , Grouping [[9,6,15,26],[4,19,23,13],[5,8,11,24],[27,12,16],[7,20,17],[14,28,21,3],[2,0,25,29],[1,22,18],[10]]
      , Grouping [[15,3,6],[28,7,4,12],[5,2,20,29,27],[8,13,26],[24,10,19,16],[17,18,11,0],[23,1,9,14,22],[21,25]]
      , Grouping [[22,5,7,17,8],[23,3,0,6],[13,29,2,18],[28,16,27],[21,20,14],[24,12,9],[4,25,1,11,26],[19,15,10]]
      , Grouping [[27,19,9,17],[29,14,20],[10,23,5,15],[3,16,4],[22,0,28,26],[21,18,7,12],[13,2,1,8],[11,6,24],[25]]
      , Grouping [[29,9,0,5],[21,19,27,1],[10,3,11,28],[20,15,24,26,6],[23,7,16,12,13],[14,2,4,8],[17,22,18],[25]]
      , Grouping [[10,19,6],[22,13,5],[7,24,17],[2,11,28,20,14],[4,25,3],[21,12,9,16,18],[26,29,8,1],[15,27,23,0]]
      , Grouping [[27,28,12],[20,15,24,18],[10,19,3,23],[11,14,5],[17,13,1],[7,22,2,8,4],[9,16,26,21],[29,0,25],[6]]
      ]

{-
  Params:
  * How many groupings to maintain (elitism)
  * Crossover probability, 0 means no crossover, 1 means always,
    a value of 0.5 means half the time there will be a crossover
    between selected pairs
  * Mutation probability, 0 means never, 1 means there will be X
    number of mutations on every child grouping, where X is the
    number of people. E.g. 0.01 means a grouping will have X*1%
    mutations, so for 100 people, there will probably always be 1
    mutation.
-}
newPopulation :: Population -> Population
newPopulation p = deleteMin p
  where keysSelectedForElitism = take 5 $ keys p

selectTwo :: Population -> (Grouping, Grouping)
selectTwo p = (p ! 0, p ! 1)

bestIn :: Population -> Grouping
bestIn p = snd $ findMin p